<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Professor - Ranking</title>
    <style>
        :root {
            --bg-page: #f5f5f7;
            --card-bg: #ffffff;
            --text-main: #1d1d1f;
            --text-light: #86868b;
            --accent: #0071e3;
            --success: #34c759;
            --warning: #ffcc00;
            --silver: #e0e0e0;
            --bronze: #cd7f32;
            --error: #ff3b30;
            --radius: 16px;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
            
            /* Cores dos Bot√µes (iguais ao site principal) */
            --btn-gray-dark: #8e8e93;  
            --btn-gray-light: #aeb0b5;
        }

        /* --- PROTE√á√ÉO ANTI-C√ìPIA --- */
        body {
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        @media print { html, body { display: none !important; } }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg-page);
            color: var(--text-main);
            min-height: 100vh;
            padding: 40px 20px;
            padding-bottom: 100px;
            overflow-x: hidden; /* Evita rolagem horizontal da p√°gina inteira */
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .titulo-pagina { font-size: 2rem; font-weight: 700; }

        .btn-voltar {
            text-decoration: none; color: var(--accent); font-weight: 600;
            display: flex; align-items: center; gap: 5px; transition: opacity 0.2s; font-size: 0.9rem; margin-bottom: 5px;
        }
        .btn-voltar:hover { opacity: 0.7; }

        .filtro-data-container {
            background: white; padding: 8px 20px; border-radius: 50px;
            box-shadow: var(--shadow); display: flex; align-items: center; gap: 10px;
        }
        .input-data { border: none; background: transparent; font-size: 1rem; color: var(--accent); font-weight: 600; cursor: pointer; outline: none; }

        /* --- ABAS DE S√âRIE (ESTILO PILLS) --- */
        .scroll-container {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 10px; /* Espa√ßo para scrollbar n√£o colar */
            margin-bottom: 25px;
            -webkit-overflow-scrolling: touch; /* Scroll suave no iOS */
        }
        
        /* Esconde a barra de rolagem mas mant√©m a fun√ß√£o */
        .scroll-container::-webkit-scrollbar { height: 4px; }
        .scroll-container::-webkit-scrollbar-thumb { background: #d2d2d7; border-radius: 4px; }
        .scroll-container::-webkit-scrollbar-track { background: transparent; }

        .abas-series {
            display: flex;
            gap: 10px;
            min-width: min-content; /* Garante que os bot√µes n√£o quebrem linha */
        }

        .aba-btn {
            background-color: white;
            border: 1px solid transparent;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            white-space: nowrap; /* N√£o quebra texto */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .aba-btn:hover { background-color: #f2f2f7; transform: translateY(-2px); }
        
        .aba-btn.ativo {
            background-color: var(--accent);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 113, 227, 0.3);
        }

        /* --- DATA E RESUMO --- */
        .grid-resumo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card-resumo {
            background: var(--card-bg); padding: 20px; border-radius: var(--radius);
            box-shadow: var(--shadow); display: flex; flex-direction: column; align-items: flex-start;
        }

        .card-titulo { font-size: 0.85rem; color: var(--text-light); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 5px; }
        .card-valor { font-size: 2rem; font-weight: 700; color: var(--text-main); }
        
        /* --- TABELA DE RANKING --- */
        .painel-ranking {
            background: var(--card-bg); border-radius: var(--radius);
            box-shadow: var(--shadow); overflow: hidden; min-height: 300px;
        }

        .tabela-header {
            display: grid; grid-template-columns: 0.5fr 2fr 1.5fr 1fr 1fr; padding: 15px 20px;
            background-color: rgba(0,0,0,0.02); border-bottom: 1px solid #e5e5ea;
            font-size: 0.8rem; font-weight: 600; color: var(--text-light); text-transform: uppercase;
        }

        .lista-alunos { list-style: none; }

        .item-aluno {
            display: grid; grid-template-columns: 0.5fr 2fr 1.5fr 1fr 1fr;
            padding: 15px 20px; align-items: center; border-bottom: 1px solid #f5f5f7;
            transition: background 0.2s;
        }
        .item-aluno:last-child { border-bottom: none; }
        .item-aluno:hover { background-color: #fafafa; }

        .posicao { font-weight: 700; color: var(--text-light); font-size: 1.1rem; }
        .rank-1 .posicao { color: transparent; text-shadow: 0 0 0 var(--warning); font-size: 1.5rem; }
        .rank-2 .posicao { color: transparent; text-shadow: 0 0 0 var(--silver); font-size: 1.5rem; }
        .rank-3 .posicao { color: transparent; text-shadow: 0 0 0 var(--bronze); font-size: 1.5rem; }

        .info-nome { font-weight: 600; font-size: 1.05rem; }
        .info-serie { display: inline-block; padding: 4px 12px; border-radius: 20px; background-color: #f2f2f7; color: var(--text-light); font-size: 0.8rem; font-weight: 600; }
        .info-nota { font-weight: 700; color: var(--success); }
        .info-tempo { font-size: 0.9rem; color: var(--text-light); text-align: right; }

        /* --- NOTIFICA√á√ïES (TOAST) --- */
        .notificacao-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none; /* Deixa clicar no que est√° atr√°s */
        }

        .toast {
            background-color: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 1;
            transition: opacity 0.5s, transform 0.5s;
            max-width: 300px;
        }

        .toast.saindo { opacity: 0; transform: translateY(-20px); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* --- RODAP√â E BOT√ÉO --- */
        .rodape-gestao {
            margin-top: 50px;
            text-align: center;
            border-top: 1px solid #e5e5ea;
            padding-top: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        /* Bot√£o igual ao site principal */
        .btn-acao-rodape {
            background-color: var(--btn-gray-dark);
            color: white;
            border: none;
            padding: 12px 30px; 
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-acao-rodape:hover { background-color: var(--error); transform: scale(1.02); }

        .texto-creditos { font-size: 0.8rem; color: var(--text-light); }

        /* --- MODAL DE RESET --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        .modal-overlay.visivel { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-box {
            background: white; padding: 30px; border-radius: 16px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: popIn 0.3s ease;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .modal-titulo { font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }
        .modal-desc { font-size: 0.95rem; color: var(--text-light); margin-bottom: 25px; line-height: 1.4; }

        .grid-botoes-reset { display: flex; flex-direction: column; gap: 10px; }
        .btn-reset-opcao {
            padding: 15px; border-radius: 12px; border: none;
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn-reset-opcao:hover { transform: scale(1.02); }
        .btn-reset-dia { background-color: #e5e5ea; color: var(--text-main); }
        .btn-reset-mes { background-color: #ffcc00; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .btn-reset-tudo { background-color: var(--error); color: white; }
        .btn-cancelar { margin-top: 15px; background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 0.9rem; text-decoration: underline; }

        @media (max-width: 700px) {
            .tabela-header { display: none; }
            .item-aluno {
                grid-template-columns: 40px 1fr auto;
                grid-template-areas: "pos nome nota" "pos serie tempo";
                gap: 5px; padding: 15px;
            }
            .posicao { grid-area: pos; align-self: center; }
            .info-nome { grid-area: nome; }
            .info-nota { grid-area: nota; text-align: right; }
            .info-serie { grid-area: serie; align-self: start; }
            .info-tempo { grid-area: tempo; text-align: right; font-size: 0.8rem; }
            .btn-voltar { font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <script>
        // Bloqueio de seguran√ßa
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if (e.keyCode == 123) return false;
            if (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'p')) return false;
            if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) return false;
        };
        document.ondragstart = function() { return false; };
    </script>

    <div id="containerNotificacoes" class="notificacao-container"></div>

    <div class="container">
        <header>
            <div class="titulo-container">
                <a href="index.html" class="btn-voltar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                    Voltar para Atividade
                </a>
                <h1 class="titulo-pagina">Painel da Turma</h1>
            </div>
            
            <div class="filtro-data-container">
                <span style="font-size:0.8rem; color:var(--text-light); font-weight:600;">Data:</span>
                <input type="date" id="filtroData" class="input-data">
            </div>
        </header>

        <div class="scroll-container">
            <div class="abas-series" id="containerAbas">
                <button class="aba-btn ativo" onclick="filtrarSerie('todas', this)">Todas</button>
                <button class="aba-btn" onclick="filtrarSerie('6¬∫ Ano A', this)">6¬∫ Ano A</button>
                <button class="aba-btn" onclick="filtrarSerie('6¬∫ Ano B', this)">6¬∫ Ano B</button>
                <button class="aba-btn" onclick="filtrarSerie('6¬∫ Ano C', this)">6¬∫ Ano C</button>
                <button class="aba-btn" onclick="filtrarSerie('7¬∫ Ano A', this)">7¬∫ Ano A</button>
                <button class="aba-btn" onclick="filtrarSerie('7¬∫ Ano B', this)">7¬∫ Ano B</button>
                <button class="aba-btn" onclick="filtrarSerie('8¬∫ Ano A', this)">8¬∫ Ano A</button>
                <button class="aba-btn" onclick="filtrarSerie('8¬∫ Ano B', this)">8¬∫ Ano B</button>
                <button class="aba-btn" onclick="filtrarSerie('9¬∫ Ano A', this)">9¬∫ Ano A</button>
                <button class="aba-btn" onclick="filtrarSerie('9¬∫ Ano B', this)">9¬∫ Ano B</button>
            </div>
        </div>

        <div class="grid-resumo">
            <div class="card-resumo">
                <span class="card-titulo">Total de Alunos</span>
                <span class="card-valor" id="totalAcessos">0</span>
            </div>
            <div class="card-resumo">
                <span class="card-titulo">M√©dia da Turma</span>
                <span class="card-valor" id="mediaAcertos" style="color: var(--accent)">0.0</span>
            </div>
            <div class="card-resumo">
                <span class="card-titulo">Melhor Desempenho</span>
                <span class="card-valor" id="melhorAluno">-</span>
            </div>
        </div>

        <div class="painel-ranking">
            <div class="tabela-header">
                <div>#</div>
                <div>Aluno</div>
                <div>S√©rie</div>
                <div>Acertos</div>
                <div style="text-align: right;">Hor√°rio</div>
            </div>
            <ul id="listaRanking" class="lista-alunos">
                </ul>
        </div>

        <div class="rodape-gestao">
            <button class="btn-acao-rodape" onclick="abrirModalReset()">
                Gerenciar Hist√≥rico
            </button>
            <div style="display:flex; flex-direction:column; gap:5px;">
                <span class="texto-creditos">√Årea restrita ao professor</span>
                <span class="texto-creditos" style="font-weight:600; color:var(--text-main)">Desenvolvido por Gilberto Fernandes - Matem√°tica</span>
            </div>
        </div>
    </div>

    <div id="modalReset" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-titulo">Limpar Dados</div>
            <div class="modal-desc">Selecione quais registros deseja apagar permanentemente.</div>
            
            <div class="grid-botoes-reset">
                <button class="btn-reset-opcao btn-reset-dia" onclick="resetar('hoje')">
                    Limpar registros de <b>Hoje</b>
                </button>
                <button class="btn-reset-opcao btn-reset-mes" onclick="resetar('mes')">
                    Limpar registros do <b>M√™s</b>
                </button>
                <button class="btn-reset-opcao btn-reset-tudo" onclick="resetar('tudo')">
                    üóëÔ∏è Resetar <b>Site Inteiro</b>
                </button>
            </div>
            
            <button class="btn-cancelar" onclick="fecharModalReset()">Cancelar</button>
        </div>
    </div>

    <script>
        // --- DADOS E L√ìGICA PRINCIPAL ---
        let todosRegistros = [];
        let serieFiltroAtual = "todas";

        function initDados() {
            const memoria = localStorage.getItem('simulacaoDB');
            if (memoria) todosRegistros = JSON.parse(memoria);
            else gerarDadosFicticiosIniciais();
        }

        function gerarDadosFicticiosIniciais() {
            const nomes = ["Ana Clara", "Jo√£o Pedro", "Beatriz", "Carlos", "Fernanda", "Gabriel", "Isabela", "Lucas", "Mariana", "Pedro"];
            const series = ["6¬∫ Ano A", "7¬∫ Ano A", "8¬∫ Ano B"];
            const hoje = new Date().toISOString().split('T')[0];
            
            for (let i = 0; i < 10; i++) {
                todosRegistros.push({
                    nome: nomes[i], serie: series[i%3], acertos: Math.floor(Math.random()*15)+5,
                    data: hoje, hora: `0${8+i}:30`
                });
            }
            salvarDadosSimulados();
        }

        function salvarDadosSimulados() {
            localStorage.setItem('simulacaoDB', JSON.stringify(todosRegistros));
        }

        // --- SISTEMA DE NOTIFICA√á√ÉO (Simulado) ---
        function mostrarNotificacao(nomeAluno) {
            const container = document.getElementById('containerNotificacoes');
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            // √çcone de usu√°rio + Texto
            toast.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                ${nomeAluno} acabou de entrar
            `;
            
            container.appendChild(toast);

            // Toca um som suave (opcional, removido para n√£o incomodar, apenas visual)

            // Remove ap√≥s 2.5 segundos
            setTimeout(() => {
                toast.classList.add('saindo');
                setTimeout(() => { toast.remove(); }, 500); // Espera a anima√ß√£o de sa√≠da
            }, 2500);
        }

        // Simula entrada de alunos a cada X segundos para dar vida ao painel
        setInterval(() => {
            // 30% de chance de algu√©m entrar a cada 4 segundos
            if(Math.random() > 0.7) { 
                const nomesNovos = ["Felipe", "J√∫lia", "Roberto", "Amanda", "Diego", "Larissa", "Bruno", "Camila"];
                const nomeSorteado = nomesNovos[Math.floor(Math.random() * nomesNovos.length)];
                
                mostrarNotificacao(nomeSorteado);
                
                // Opcional: Adicionar esse aluno fict√≠cio √† tabela em tempo real
                // Isso faria a tabela crescer enquanto voc√™ olha
                const novaEntrada = {
                   nome: nomeSorteado,
                   serie: "6¬∫ Ano B", // Simula√ß√£o
                   acertos: 0, // Acabou de entrar
                   data: new Date().toISOString().split('T')[0],
                   hora: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                };
                todosRegistros.push(novaEntrada);
                salvarDadosSimulados();
                renderizarRanking();
            }
        }, 4000);

        // --- FILTROS E RENDERIZA√á√ÉO ---
        const listaEl = document.getElementById('listaRanking');
        const filtroData = document.getElementById('filtroData');
        filtroData.valueAsDate = new Date();

        function filtrarSerie(serie, elementoBotao) {
            serieFiltroAtual = serie;
            
            // Atualiza visual dos bot√µes
            document.querySelectorAll('.aba-btn').forEach(btn => btn.classList.remove('ativo'));
            elementoBotao.classList.add('ativo');

            renderizarRanking();
        }

        function renderizarRanking() {
            const dataSelecionada = filtroData.value;

            // Filtra
            let filtrados = todosRegistros.filter(item => {
                const bateData = item.data === dataSelecionada;
                const bateSerie = serieFiltroAtual === "todas" ? true : item.serie === serieFiltroAtual;
                return bateData && bateSerie;
            });

            // Ordena
            filtrados.sort((a, b) => b.acertos - a.acertos);

            // Atualiza Cards
            document.getElementById('totalAcessos').innerText = filtrados.length;
            
            let totalAcertos = filtrados.reduce((sum, item) => sum + item.acertos, 0);
            let media = filtrados.length ? (totalAcertos / filtrados.length).toFixed(1) : "0.0";
            document.getElementById('mediaAcertos').innerText = media;

            document.getElementById('melhorAluno').innerText = filtrados.length > 0 ? filtrados[0].nome : "-";

            // Renderiza Lista
            listaEl.innerHTML = "";
            if (filtrados.length === 0) {
                listaEl.innerHTML = `<li style="padding:50px; text-align:center; color:var(--text-light)">Nenhum registro encontrado.</li>`;
                return;
            }

            filtrados.forEach((aluno, index) => {
                let rankClass = "";
                let iconePosicao = index + 1;
                if (index === 0) { rankClass = "rank-1"; iconePosicao = "ü•á"; }
                else if (index === 1) { rankClass = "rank-2"; iconePosicao = "ü•à"; }
                else if (index === 2) { rankClass = "rank-3"; iconePosicao = "ü•â"; }

                const html = `
                    <li class="item-aluno ${rankClass}">
                        <div class="posicao">${iconePosicao}</div>
                        <div class="info-nome">${aluno.nome}</div>
                        <div><span class="info-serie">${aluno.serie}</span></div>
                        <div class="info-nota">${aluno.acertos} pts</div>
                        <div class="info-tempo">${aluno.hora}</div>
                    </li>
                `;
                listaEl.innerHTML += html;
            });
        }

        // --- MODAL DE RESET ---
        function abrirModalReset() { document.getElementById('modalReset').classList.add('visivel'); }
        function fecharModalReset() { document.getElementById('modalReset').classList.remove('visivel'); }

        function resetar(tipo) {
            if (!confirm("Confirmar exclus√£o?")) return;
            const hoje = new Date().toISOString().split('T')[0];
            const mesAtual = new Date().toISOString().slice(0, 7);

            if (tipo === 'hoje') todosRegistros = todosRegistros.filter(item => item.data !== hoje);
            else if (tipo === 'mes') todosRegistros = todosRegistros.filter(item => !item.data.startsWith(mesAtual));
            else if (tipo === 'tudo') todosRegistros = [];

            salvarDadosSimulados();
            renderizarRanking();
            fecharModalReset();
        }

        filtroData.addEventListener('change', renderizarRanking);

        // Inicializa
        initDados();
        renderizarRanking();

    </script>
</body>
</html>
